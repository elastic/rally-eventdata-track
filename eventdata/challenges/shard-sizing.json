{
  "name": "shard-sizing",
  "description": "Indexes sets of 2M events into Elasticsearch, followed by index statistics and simulated Kibana queries. IDs are autogenerated by Elasticsearch, meaning there are no conflicts. This process is repeatedly run until 50M events have been indexed into the shard. This allows query latency to be evaluated as a function of shard size.",
  "meta": {
    "benchmark_type": "shard-sizing"
  },
  "schedule": [
    {
      "operation": "delete-index"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "settings": {
          "index.number_of_replicas": 0,
          "index.number_of_shards": 1,
          "index.refresh_interval": "5s",
          "index.codec": "best_compression"
        }
      }
    },
    {% for n in range(1, shard_sizing_iterations | default(25) ) %}
    {
      "name": "index-append-1000-shard-sizing-iteration-{{n}}",
      "operation": "index-append-1000-shard-sizing",
      "iterations": 2000,
      "clients": 8,
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {
      "name": "indicesstats_elasticlogs-iteration-{{n}}",
      "operation": "indicesstats_elasticlogs",
      "iterations": 1,
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {
      "name": "kibana-traffic-shard-sizing-50%-iteration-{{n}}",
      "operation": "kibana-traffic-shard-sizing-50%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {
      "name": "kibana-traffic-shard-sizing-90%-iteration-{{n}}",
      "operation": "kibana-traffic-shard-sizing-90%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {
      "name": "kibana-content_issues-shard-sizing-50%-iteration-{{n}}",
      "operation": "kibana-content_issues-shard-sizing-50%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {
      "name": "kibana-content_issues-shard-sizing-90%-iteration-{{n}}",
      "operation": "kibana-content_issues-shard-sizing-90%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {% endfor %}
    {
      "operation": "index-append-1000-shard-sizing",    
      "iterations": 2000,
      "clients": 8,
      "meta": {
        "iteration_number": {{ shard_sizing_iterations | default(25) }}
      }
    },
    {
      "operation": "indicesstats_elasticlogs",
      "iterations": 1,
      "meta": {
        "iteration_number": {{ shard_sizing_iterations | default(25) }}
      }
    },
    {
      "operation": "kibana-traffic-shard-sizing-50%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ shard_sizing_iterations | default(25) }}
      }
    },
    {
      "operation": "kibana-traffic-shard-sizing-90%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ shard_sizing_iterations | default(25) }}
      }
    },
    {
      "operation": "kibana-content_issues-shard-sizing-50%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ shard_sizing_iterations | default(25) }}
      }
    },
    {
      "operation": "kibana-content_issues-shard-sizing-90%",
      "iterations": {{ shard_sizing_queries | default(20) }},
      "meta": {
        "iteration_number": {{ shard_sizing_iterations | default(25) }}
      }
    }
  ]
}