{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(8)) %}
{% set p_iterations = bulk_indexing_iterations | default(2000) %}
{% set p_iterations_per_client = (p_iterations / p_bulk_indexing_clients) | int %}

{
  "name": "shard-size-on-disk",
  "description": "Indexes sets of 2M events into Elasticsearch, followed by index statistics in order to track how index size depends on event count. IDs are autogenerated by Elasticsearch, meaning there are no conflicts. This process is repeatedly run until 100M events have been indexed into the shard.",
  "meta": {
    "benchmark_type": "shard-size-on-disk"
  },
  "schedule": [
    {
      "operation": "deleteindex_elasticlogs"
    },
    {
      "operation": "delete-index-template"
    },
    {
      "operation": "create-index-template"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "index": "elasticlogs"
      }
    },
    {% set comma = joiner() %}
    {% for n in range(1,51) %}
    {{comma()}}
    {
      "name": "index-append-1000-shard-sizing-{{n}}",
      "operation": "index-append-1000-shard-sizing",
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {
      "name": "indicesstats_elasticlogs-{{n}}",
      "operation": "indicesstats_elasticlogs",
      "meta": {
        "iteration_number": {{ n }}
      }
    }
    {% endfor %}
  ]
}
