{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(8)) %}

{
  "name": "shard-size-on-disk",
  "description": "Indexes sets of 2M events into Elasticsearch, followed by index statistics in order to track how index size depends on event count. IDs are autogenerated by Elasticsearch, meaning there are no conflicts. This process is repeatedly run until 100M events have been indexed into the shard.",
  "meta": {
    "benchmark_type": "shard-size-on-disk"
  },
  "schedule": [
    {
      "operation": "delete-index"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "settings": {
          "index.number_of_replicas": 0,
          "index.number_of_shards": 1,
          "index.refresh_interval": "5s",
          "index.codec": "best_compression"
        }
      }
    },
    {% for n in range(1,50) %}
    {
      "name": "index-append-1000-shard-sizing-{{n}}",
      "operation": "index-append-1000-shard-sizing",
      "iterations": 2000,
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {
      "name": "indicesstats_elasticlogs-{{n}}",
      "operation": "indicesstats_elasticlogs",
      "iterations": 1,
      "meta": {
        "iteration_number": {{ n }}
      }
    },
    {% endfor %}
    {
      "operation": "index-append-1000-shard-sizing",
      "iterations": 2000,
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "iteration_number": {{ 50 }}
      }
    },
    {
      "operation": "indicesstats_elasticlogs",
      "iterations": 1,
      "meta": {
        "iteration_number": {{ 50 }}
      }
    }
  ]
}