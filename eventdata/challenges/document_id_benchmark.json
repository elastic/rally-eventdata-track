{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(20)) %}
{% set p_iterations = bulk_indexing_iterations | default(100000) %}
{% set p_iterations_per_client = (p_iterations / p_bulk_indexing_clients) | int %}

{
  "name": "document_id_evaluation",
  "description": "Index about 20GB of data into five single shard indices using different document ID types. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "client_count": {{ p_bulk_indexing_clients }},
    "benchmark_type": "document-id-evaluation"
  },
  "schedule": [
    {
      "name": "deleteindex_elasticlogs-auto",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-auto"
      }
    },
    {
      "name": "deleteindex_elasticlogs-uuid",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-uuid"
      }
    },
    {
      "name": "deleteindex_elasticlogs-epoch-no_delay",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-epoch-no_delay"
      }
    },
    {
      "name": "deleteindex_elasticlogs-epoch-10pct_60s",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-epoch-10pct_60s"
      }
    },
    {
      "name": "deleteindex_elasticlogs-epoch-10pct_300s",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-epoch-10pct_300s"
      }
    },
    {
      "name": "create_elasticlogs-auto",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-auto",
        "index_template_body": {
          "template": "elasticlogs-auto",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-auto"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-auto",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-auto",
        "bulk-size": 1000
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "auto"
      }
    },
    {
      "name": "create_elasticlogs-uuid",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-uuid",
        "index_template_body": {
          "template": "elasticlogs-uuid",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-uuid"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-uuid",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-uuid",
        "bulk-size": 1000,
        "id_type": "uuid"
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "uuid"
      }
    },
    {
      "name": "create_elasticlogs-epoch-no_delay",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-epoch-no_delay",
        "index_template_body": {
          "template": "elasticlogs-epoch-no_delay",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-epoch-no_delay"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-epoch-no_delay",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-epoch-no_delay",
        "bulk-size": 1000,
        "id_type": "epoch_uuid"
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "epoch_uuid-no_delay"
      }
    },
    {
      "name": "create_elasticlogs-epoch-10pct_60s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-epoch-10pct_60s",
        "index_template_body": {
          "template": "elasticlogs-epoch-10pct_60s",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-epoch-10pct_60s"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-epoch-10pct_60s",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-epoch-10pct_60s",
        "bulk-size": 1000,
        "id_type": "epoch_uuid",
        "id_delay_probability": 0.1,
        "id_delay_secs": 60
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "epoch_uuid-10pct/60s"
      }
    },
    {
      "name": "create_elasticlogs-epoch-10pct_300s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-epoch-10pct_300s",
        "index_template_body": {
          "template": "elasticlogs-epoch-10pct_300s",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-epoch-10pct_300s"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-epoch-10pct_300s",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-epoch-10pct_300s",
        "bulk-size": 1000,
        "id_type": "epoch_uuid",
        "id_delay_probability": 0.1,
        "id_delay_secs": 300
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "epoch_uuid-10pct/300s"
      }
    }
  ]
}
