{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(20)) %}
{% set p_iterations = bulk_indexing_iterations | default(1000000) %}
{% set p_iterations_per_client = (p_iterations / p_bulk_indexing_clients) | int %}

{
  "name": "elasticlogs-1bn-load",
  "description": "Indexes 1bn (default) documents into elasticlogs_q-* indices. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "default": true,
  "meta": {
    "client_count": {{ p_bulk_indexing_clients }},
    "benchmark_type": "indexing"
  },
  "schedule": [
    {
      "operation": "delete-index-template"
    },
    {
      "operation": "deleteindex_elasticlogs_q-*"
    },
    {
      "operation": "create-index-template"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "index": "elasticlogs_q-000001",
        "body": {
          "aliases" : {
            "elasticlogs_q_write" : {}
          }
        }
      }
    },
    {
      "parallel": {
        "completed-by": "index-append-1000-elasticlogs_q_write",
        "tasks": [
          {
            "operation": "index-append-1000-elasticlogs_q_write",    
            "iterations": {{ p_iterations_per_client }},
            "clients": {{ p_bulk_indexing_clients }}
          }
          {% if rollover_enabled | default(true) %}
          ,
          {
            "operation": "rollover_elasticlogs_q_write_100M",
            "clients": 1,
            "warmup-iterations": 1000000,
            "iterations": 1000000,
            "target-interval": 30
          }
          {% endif %}
        ]
      }
    },
    {
      "operation": "node_storage"
    }
  ]
}
