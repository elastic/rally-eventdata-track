{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(16)) %}
{% set p_replica_count = (number_of_replicas | default(0)) %}
{% set p_shard_count = (shard_count | default(2)) %}

{
  "name": "bulk-size-evaluation",
  "description": "Indexes with different bulk sizes. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "client_count": {{ p_bulk_indexing_clients }},
    "benchmark_type": "indexing_bulksize"
  },
  "schedule": [
    {
      "operation": "delete-index"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "settings": {
            "index.number_of_replicas": {{ p_replica_count }},
            "index.number_of_shards": {{ p_shard_count }}
        }
      }
    },
    {
      "operation": "index-append-125",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-250",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-500",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-1000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-2000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-5000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-10000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-20000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-50000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    }
  ]
},
{
  "name": "bulk-size-evaluation-mini",
  "description": "Indexes with bulk sizes of 125 and 1000. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "client_count": {{ p_bulk_indexing_clients }},
    "benchmark_type": "indexing_bulksize"
  },
  "schedule": [
    {
      "operation": "delete-index"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "settings": {
            "index.number_of_replicas": {{ p_replica_count }},
            "index.number_of_shards": {{ p_shard_count }}
        }
      }
    },
    {
      "operation": "index-append-125",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-1000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    }
  ]
},
{
  "name": "bulk-size-concurrency-evaluation",
  "description": "Indexes with different bulk sizes and number of connections (2, 20, and 200) while keeping the number of documents in flight constant. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "benchmark_type": "indexing_bulksize"
  },
  "schedule": [
    {
      "name": "delete-index-2clients",
      "operation": "delete-index"
    },
    {
      "name": "create-index-2clients",
      "operation": {
        "operation-type": "create-index",
        "settings": {
            "index.number_of_replicas": {{ p_replica_count }},
            "index.number_of_shards": {{ p_shard_count }}
        }
      }
    },
    {
      "name": "index-append-1000-2clients",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "bulk-size": 1000,
        "record_raw_event_size": {{p_record_raw_event_size}}
      },
      "warmup-time-period": 300,
      "time-period": 600,
      "clients": 2
    },
    {
      "name": "delete-index-20clients",
      "operation": "delete-index"
    },
    {
      "name": "create-index-20clients",
      "operation": {
        "operation-type": "create-index",
        "settings": {
            "index.number_of_replicas": {{ p_replica_count }},
            "index.number_of_shards": {{ p_shard_count }}
        }
      }
    },
    {
      "name": "index-append-100-20clients",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "bulk-size": 100,
        "record_raw_event_size": {{p_record_raw_event_size}}
      },
      "warmup-time-period": 300,
      "time-period": 600,
      "clients": 20
    },
    {
      "name": "delete-index-200clients",
      "operation": "delete-index"
    },
    {
      "name": "create-index-200clients",
      "operation": {
        "operation-type": "create-index",
        "settings": {
            "index.number_of_replicas": {{ p_replica_count }},
            "index.number_of_shards": {{ p_shard_count }}
        }
      }
    },
    {
      "name": "index-append-10-200clients",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "bulk-size": 10,
        "record_raw_event_size": {{p_record_raw_event_size}}
      },
      "warmup-time-period": 300,
      "time-period": 600,
      "clients": 200
    }
  ]
}

