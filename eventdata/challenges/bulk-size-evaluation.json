{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(16)) %}
{% set p_replica_count = (number_of_replicas | default(0)) %}
{% set p_shard_count = (shard_count | default(2)) %}

{
  "name": "bulk-size-evaluation",
  "description": "Indexes with different bulk sizes. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "client_count": {{ p_bulk_indexing_clients }},
    "benchmark_type": "indexing_bulksize"
  },
  "schedule": [
    {
      "operation": "deleteindex_elasticlogs"
    },
    {
      "operation": "delete-index-template"
    },
    {
      "operation": "create-index-template"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "index": "elasticlogs",
        "body": {
          "settings": {
              "index.number_of_replicas": {{ p_replica_count }},
              "index.number_of_shards": {{ p_shard_count }}
          }
        }
      }
    },
    {
      "operation": "index-append-125",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-250",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-500",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-1000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-2000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-5000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-10000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-20000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-50000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    }
  ]
},
{
  "name": "bulk-size-evaluation-mini",
  "description": "Indexes with bulk sizes of 125 and 1000. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "client_count": {{ p_bulk_indexing_clients }},
    "benchmark_type": "indexing_bulksize"
  },
  "schedule": [
    {
      "operation": "deleteindex_elasticlogs"
    },
    {
      "operation": "delete-index-template"
    },
    {
      "operation": "create-index-template"
    },
    {
      "operation": {
        "operation-type": "create-index",
        "index": "elasticlogs",
        "settings": {
            "index.number_of_replicas": {{ p_replica_count }},
            "index.number_of_shards": {{ p_shard_count }}
        }
      }
    },
    {
      "operation": "index-append-125",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    },
    {
      "operation": "index-append-1000",
      "warmup-time-period": 0,
      "time-period": 600,
      "clients": {{ p_bulk_indexing_clients }}
    }
  ]
},
{
  "name": "bulk-size-concurrency-evaluation",
  "description": "Indexes with different bulk sizes and number of connections (2, 20, and 100) while keeping the number of documents in flight constant. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "benchmark_type": "indexing_bulksize"
  },
  "schedule": [
    {
      "operation": "delete-index-template"
    },
    {
      "operation": "create-index-template"
    },
{% set comma = joiner() %}
{% for factor in [1, 10, 50] %}
{{comma()}}
{% set concurrency_evaluation_clients = 2 * factor %}
{% set concurrency_evaluation_bulk_size = 1000 // factor %}
    {
      "name": "delete-index-{{concurrency_evaluation_clients}}clients",
      "operation": "deleteindex_elasticlogs"
    },
    {
      "name": "create-index-{{concurrency_evaluation_clients}}clients",
      "operation": {
        "operation-type": "create-index",
        "index": "elasticlogs",
        "body": {
          "settings": {
              "index.number_of_replicas": {{ p_replica_count }},
              "index.number_of_shards": {{ p_shard_count }}
          }
        }
      }
    },
    {
      "name": "index-append-{{concurrency_evaluation_bulk_size}}-{{concurrency_evaluation_clients}}clients",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs",
        "bulk-size": {{concurrency_evaluation_bulk_size}},
        "record_raw_event_size": {{p_record_raw_event_size}}
      },
      "warmup-time-period": 300,
      "time-period": 600,
      "clients": {{concurrency_evaluation_clients}}
    }
{% endfor%}
  ]
}

