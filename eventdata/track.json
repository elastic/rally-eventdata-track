{% import "rally.helpers" as rally with context %}

{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(8)) %}

{
  "version": 2,
  "description": "Track for simulating different aspects of event-based use cases.",
  "indices": [
    {
      "name": "elasticlogs",
      "body": "elasticlogs-index.json",
      "types": [ "logs" ],
      "auto-managed": false
    }
  ],
  "#COMMENT": "'operations' just define all possible operations but this is not the actual execution schedule. The execution is defined in the 'challenges' block and it just refers to the defined operations. The intention between this separation is to allow reuse of operations",
  "operations": [
    {{ rally.collect(parts="operations/*.json") }}
  ],
  "challenges": [
    {
      "name": "append-no-conflicts",
      "default": true,
      "description": "Runs indexing with a batch size of 1000 for 20 minutes. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
      "meta": {
        "client_count": {{ p_bulk_indexing_clients }}
      },
      "schedule": [
        {
          "operation": "delete-index"
        },
        {
          "operation": {
            "operation-type": "create-index",
            "settings": {
                "index.number_of_replicas": {{ number_of_replicas | default(0) }},
                "index.number_of_shards": {{ shard_count | default(2) }}
            }
          }
        },
        {
          "operation": "index-append-1000",
          "warmup-time-period": 0,
          "time-period": 1200,
          "clients": {{ p_bulk_indexing_clients }}
        }
      ]
    },
    {{ rally.collect(parts="challenges/*.json") }}
  ]
}
